---
import type { CollectionEntry } from 'astro:content'
import FormattedDate from '../components/FormattedDate.astro'
import type { MarkdownHeading, ImageMetadata } from 'astro'
import TableOfContents from '../components/TableOfContents.astro'

type Props = CollectionEntry<'blog'>['data'] & { headings: MarkdownHeading[] }

const {
	title,
	description,
	pubDate,
	updatedDate,
	heroImage,
	heroImageCredit,
	headings,
} = Astro.props

import BaseLayout from './BaseLayout.astro'
import { Image } from 'astro:assets'

const blogImages = import.meta.glob<{ default: ImageMetadata }>(
	'/src/assets/blogimages/**/*.{jpeg,jpg,png,gif}'
)

---

<BaseLayout title={title} description={description}>
	<main>
		<article>
			<div
				class="app-container flex flex-col lg:flex-row justify-between gap-8 py-24 relative"
			>
				<div class="grow w-full md:max-w-[75ch]">
					<div>
						<div>
							<h1 class="text-5xl leading-snug pt-12 font-bold">
								{title}
							</h1>
							<div
								class="text-lg uppercase flex items-center gap-2 flex-nowrap py-8"
							>
								<FormattedDate date={pubDate} />
								{
									updatedDate && (
										<span class="italic capitalize">
											Last updated on <FormattedDate date={updatedDate} />
										</span>
									)
								}
							</div>
							{
								heroImage && blogImages[heroImage] && (
									<Image src={blogImages[heroImage]()} alt={title} class='rounded-lg' />
									<p class="mt-2 mb-8 opacity-80 italic text-sm">
										Image Credit: {heroImageCredit}
									</p>
								)
							}
						</div>
					</div>
					<div
						class="prose prose-neutral prose-lg md:prose-xl dark:prose-invert prose-img:rounded-xl prose-figure:text-center prose-img:mx-auto"
					>
						<slot />
					</div>
				</div>
				<div class="md:w-1/4 relative">
					<div class="sticky top-0 md:top-28 hidden md:block">
						<TableOfContents headings={headings} />
					</div>
				</div>
			</div>
		</article>
	</main>
	<style>
		@reference "../styles/global.css";
	</style>
</BaseLayout>
