---
import HeaderLink from './HeaderLink.astro'
import { Icon } from 'astro-icon/components'
import ThemeSelector from './ThemeSelector.astro'

const links = [
  {
    display: 'Home',
    location: '/',
  },
  {
    display: 'Blog',
    location: '/blog',
  },
  {
    display: 'Projects',
    location: '/projects',
  },
]
---

<header class="fixed top-0 w-full z-40">
  <nav class="bg-background text-foreground transition-colors duration-300">
    <div
      class="container mx-auto flex px-6 justify-between items-center py-4 sm:px-20 2xl:px-16"
    >
      <h2>
        <a href="/" class="text-foreground">
          <svg
            class="text-primary hover:animate-wiggle"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="36"
            height="36"
            fill="none"
          >
            <path
              d="M7.64584 15.7108C7.23279 14.8966 7 13.9755 7 13C7 9.78484 9.5 7.5 13 7C17.0817 6.4169 18.8333 4.16667 20 3C23.5 16 17 19 13 19C11.9071 19 10.8825 18.7078 10 18.1973"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
            <path
              d="M3 21C3.5 18 5.45791 16.1355 10 15C13.2167 14.1958 15.4634 12.1791 17 10.0549"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"></path>
          </svg>
          <span class="hidden">Home</span></a
        >
      </h2>
      <div class="gap-14 hidden md:flex items-center">
        {
          links.map((link) => (
            <HeaderLink class:list="font-normal uppercase" href={link.location}>
              {link.display}
            </HeaderLink>
          ))
        }
      </div>
      <a
        href="mailto:yash25.j@gmail.com"
        class="md:block hidden items-center gap-2 w-fit px-4 py-2 md:bg-primary/30 rounded-full font-semibold text-sm uppercase transition-colors duration-75 hover:bg-primary/50"
        >Contact</a
      >
      <button class="md:hidden" id="nav-open-btn">
        <Icon name="mdi:menu" size={32} />
      </button>

      <!-- Mobile nav -->
      <div
        class="translate-x-full fixed top-0 right-0 bg-white dark:bg-neutral-900 h-screen w-5/6 px-8 py-6 transition-transform z-40 border-l-[1px] border-background"
        id="mobile-menu"
      >
        <button id="nav-close-btn" class="ml-auto block">
          <Icon name="mdi:close" size={32} />
        </button>
        <div class="flex flex-col h-full items-start gap-8 pt-28">
          {
            links.map((link) => (
              <HeaderLink class="text-5xl font-light" href={link.location}>
                {link.display}
              </HeaderLink>
            ))
          }
          <HeaderLink
            class="text-5xl font-light"
            href="mailto:yash25.j@gmail.com"
          >
            Contact
          </HeaderLink>
          <ThemeSelector class:list="mt-4" />
        </div>
      </div>
    </div>
  </nav>

  <script>
    function toggleNav() {
      document
        .querySelector('#mobile-menu')
        ?.classList.toggle('translate-x-full')
    }

    document
      .querySelector('#nav-open-btn')
      ?.addEventListener('click', toggleNav)
    document
      .querySelector('#nav-close-btn')
      ?.addEventListener('click', toggleNav)
  </script>
</header>

<script is:inline>
  function reComputeTheme() {
    console.log('Ran reComputeTheme')
    if (
      localStorage.theme === 'dark' ||
      (!('theme' in localStorage) &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark')
    } else {
      document.documentElement.classList.remove('dark')
    }

    let theme = localStorage.theme || 'auto'
    document
      .querySelectorAll(`[data-theme="theme-${theme}"]`)
      .forEach((el) => el.classList.add('active'))
  }

  function addThemeEventListeners() {
    console.log('Ran addThemeEventListeners')
    themeButtons = document.querySelectorAll('.theme-button')
    console.log(themeButtons.length)
    themeButtons.forEach((button) => {
      button.addEventListener('click', () => {
        themeButtons.forEach((btn) => btn.classList.remove('active'))
        button.classList.add('active')
        if (button.dataset.theme === 'theme-auto') {
          localStorage.removeItem('theme')
          reComputeTheme()
        } else {
          localStorage.theme = button.dataset.theme.replace('theme-', '')
          document.documentElement.classList.toggle(
            'dark',
            button.dataset.theme === 'theme-dark'
          )
        }
      })
    })
  }

  // Set active class on OS theme change
  window
    .matchMedia('(prefers-color-scheme: dark)')
    .addEventListener('change', (e) => {
      reComputeTheme()
    })

  // run recomputeTheme when screen crosses 768px
  window.matchMedia('(min-width: 768px)').addEventListener('change', (e) => {
    addThemeEventListeners()
    reComputeTheme()
  })

  reComputeTheme()

  // Run on page load
  window.addEventListener('DOMContentLoaded', () => {
    addThemeEventListeners()
    reComputeTheme()
  })
</script>
